<!DOCTYPE html>
<html>
<head>
    <title>Rails7WithDocker</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%# Multiples sources pour Font Awesome %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/fr.js"></script>

</head>

<body>
<% flash.each do |type, message| %>
    <div class="alert <%= type == 'notice' ? 'alert-success' : 'alert-danger' %> alert-dismissible fade show" role="alert">
        <%= message %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
<% end %>
<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm mb-4">
    <div class="container">
    <span class="navbar-brand fw-bold text-primary">
      <i class="fas fa-mountain"></i> Randonnées
    </span>
        <div class="d-flex gap-3">
            <%= link_to stats_dashboard_path,
                        class: "btn #{current_page?(stats_dashboard_path) ? 'btn-primary' : 'btn-outline-primary'}" do %>
                <i class="fas fa-chart-line"></i> Dashboard
            <% end %>
            <%= link_to hikes_path,
                        class: "btn #{current_page?(hikes_path) ? 'btn-primary' : 'btn-outline-primary'}" do %>
                <i class="fas fa-hiking"></i> Liste des randonnées
            <% end %>
        </div>
    </div>
</nav>
<div class="container py-2">
    <% todays_hike = Hike.todays_hike %>
    <div class="card">
        <div class="card-body p-2">
            <div class="d-flex align-items-center gap-2">
                <i class="fas fa-calendar-day text-primary"></i>
                <strong>
                    <% if todays_hike&.hiking_date == Date.current %>
                        Randonnée du jour
                    <% else %>
                        Prochaine randonnée
                        <% if todays_hike&.hiking_date.present? %>
                            (<%= l(todays_hike.hiking_date, format: :long) %>)
                        <% end %>
                    <% end %>
                </strong>
                <% if todays_hike %>
                    <% if todays_hike.difficulty_text.present? %>
                        <span class="badge bg-primary ms-2"><%= todays_hike.difficulty_text %></span>
                    <% end %>

                    <% if todays_hike.starting_point.present? %>
                        <i class="fas fa-map-marker-alt text-muted ms-2"></i>
                        <span><%= todays_hike.starting_point %></span>
                    <% end %>

                    <% if todays_hike.departure_time.present? %>
                        <i class="fas fa-clock text-muted ms-2"></i>
                        <span><%= todays_hike.departure_time %></span>
                    <% end %>

                    <% if todays_hike.guide_name.present? %>
                        <i class="fas fa-user text-muted ms-2"></i>
                        <span><%= todays_hike.guide_name %></span>
                    <% end %>

                    <% if todays_hike.distance_km.present? %>
                        <i class="fas fa-route text-muted ms-2"></i>
                        <span><%= todays_hike.distance_km %> km</span>
                    <% end %>

                    <% if todays_hike.elevation_gain.present? %>
                        <i class="fas fa-mountain text-muted ms-2"></i>
                        <span><%= todays_hike.elevation_gain %>m D+</span>
                    <% end %>

                    <% if todays_hike.openrunner_ref.present? && todays_hike.openrunner_ref != "0" %>
                        <%= link_to "https://www.openrunner.com/route-details/#{todays_hike.openrunner_ref}",
                                    class: "btn btn-sm btn-outline-primary py-0 ms-auto",
                                    target: "_blank" do %>
                            <i class="fas fa-map"></i> OpenRunner
                        <% end %>
                    <% end %>
                <% else %>
                    <span class="text-muted">
                        <i class="fas fa-info-circle"></i> Aucune randonnée programmée
                    </span>
                <% end %>
            </div>
        </div>
    </div>
</div>
<%= yield %>
</body>
</html>